networks:
  games:
    driver: macvlan
    driver_opts:
      parent: enp9s0.17
    ipam:
      config:
        - gateway: 192.168.17.1
          subnet: 192.168.17.0/24
      driver: default
 
services:
  minecraft:
    deploy:
      resources:
        limits:
          cpus: 8.0
          memory: 8192M
    dns:
     - 192.168.6.2
    image: itzg/minecraft-server
    ports:
      - "25565:25565"
    volumes:
      - "/mnt/zfs/games/minecraft:/data"
    environment:
      EULA: "TRUE"
      ENABLE_AUTOPAUSE: "TRUE"
      OVERRIDE_SERVER_PROPERTIES: "TRUE"
      MAX_TICK_TIME: "-1"
      MEMORY: "8G"
      UID: 989
      GID: 10017
    restart: unless-stopped
    logging:
      driver: journald
      options: {}
    networks:
      games:
        ipv4_address: 192.168.17.2

  valheim: 
    deploy:
      resources:
        limits:
          cpus: 8.0
          memory: 8192M
    dns:
     - 192.168.6.2
    image: ghcr.io/lloesche/valheim-server
    cap_add:
      - sys_nice
    volumes: 
      - /mnt/zfs/games/valheim-server/config:/config
      - /mnt/zfs/games/valheim-server/data:/opt/valheim
    ports: 
      - "2456-2457:2456-2457/udp"
      - "9001:9001/tcp"
    environment:
      SERVER_NAME: ""
      SERVER_PASS: ""
      SERVER_PUBLIC: "false"
      UPDATE_CRON: "*/15 * * * *"
      UPDATE_IF_IDLE: "true"
      RESTART_CRON: "0 5 * * *"
      RESTART_IF_IDLE: "true"
      TZ: "Australia/NSW"
      BACKUPS: "true"
      BACKUPS_CRON: "0 * * * *"
      BACKUPS_MAX_AGE: 3
      PUID: 975
      PGID: 10017
      VALHEIM_PLUS: "true"
      VPCFG_ValheimPlus_serverBrowserAdvertisement: "false"
      VPCFG_Beehive_enabled: "true"
      VPCFG_Beehive_autoDeposit: "true"
      VPCFG_Beehive_showDuration: "true"
      VPCFG_Fermenter_enabled: "true"
      VPCFG_Fermenter_autoDeposit: "true"
      VPCFG_Smelter_enabled: "true"
      VPCFG_Smelter_maximumOre: 50
      VPCFG_Smelter_maximumCoal: 100
      VPCFG_Smelter_autoDeposit: "true"
      VPCFG_Furnace_enabled: "true"
      VPCFG_Furnace_maximumOre: 50
      VPCFG_Furnace_maximumCoal: 100
      VPCFG_Furnace_autoDeposit: "true"
      VPCFG_Hud_enabled: "true"
      VPCFG_Hud_showRequiredItems: "true"
      VPCFG_Kiln_enabled: "true"
      VPCFG_Kiln_maximumWood: 100
      VPCFG_Kiln_autoDeposit: "true"
      VPCFG_Map_enabled: "true"
      VPCFG_Map_shareMapProgression: "true"
      VPCFG_Map_preventPlayerFromTurningOffPublicPosition: "true"
      VPCFG_Player_enabled: "true"
      VPCFG_Player_autoRepair: "true"
      VPCFG_Player_skipIntro: "true"
      VPCFG_Server_enabled: "true"
      VPCFG_Server_dataRate: 2048
      VPCFG_Server_maxPlayers: 25
      VPCFG_Server_serverSyncsConfig: "true"
      VPCFG_Windmill_enabled: "true"
      VPCFG_Windmill_maximumBarley: 200
      VPCFG_Windmill_autoDeposit: "true"
      VPCFG_SpinningWheel_enabled: "true"
      VPCFG_SpinningWheel_maximumFlax: 200
      VPCFG_SpinningWheel_autoDeposit: "true"
      VPCFG_GameClock_enabled: "true"
      VPCFG_GameClock_useAMPM: "true"
      VPCFG_GameClock_textFontSize: 20
      VPCFG_GameClock_textTransparencyChannel: 200
      VPCFG_Chat_enabled: "true"
      VPCFG_Chat_forcedCase: "false"
    restart: unless-stopped
    stop_grace_period: 2m
    networks:
      games:
        ipv4_address: 192.168.17.3

version: "3"